#!/usr/bin/env bash
# Configuration
# -------------
# The Manifest path is relative to THIS script.
# If you copy-and-paste this into your pre-commit hook
# and your AndroidManifest.xml is in the root of your repo
# then the path would be:
# MANIFEST="../../AndroidManifest.xml"

# If this is in the same directory then it's just:
MANIFEST="AndroidManifest.xml"

# Script DO NOT MODIFY (unless you want to)

declare -x SCRIPTPATH="${0}"

FULLPATH=${SCRIPTPATH%/*}/$MANIFEST


if [ -f $FULLPATH ]
then
    LINE=$(grep -o ${FULLPATH} -e 'android:versionCode="[0-9]*"');
    declare -a LINE;
    LINE=(`echo $LINE | tr "\"" " "`);
    VERSION=(${LINE[1]});
    INCREMENTED=$(($VERSION+1))
    sed "s/android:versionCode=\"[0-9]*\"/android:versionCode=\"${INCREMENTED}\"/" $FULLPATH > $FULLPATH.tmp && mv $FULLPATH.tmp $FULLPATH
    git add $FULLPATH
    echo "Updated android:versionCode to ${INCREMENTED} in ${FULLPATH}";
fi;

